<html>
<style>
#maps_list{
    margin-left:auto;
    padding-top:2px;
    padding-bottom:2px;
    border-spacing: 0px 5px;
    display: table;
    width: 448px;
    border-radius: 3px;
    background: #CDD8E2;
    border-radius: 3px;
}

.map_block{

}
</style>
<body>
    <div>
        <div class='timer'><span id='clock'></span><span id='clock_picture'></span></div>
        <div id='maps_list'>

        </div>
    </div>
</body>
<script>
var socket ;
let url = 'ws://'+window.location.origin.replace('http://','').replace('https://','').replace(/\:\d+$/g,':8080')
let id=0
let check = false;

function update(){
    document.getElementById('maps_list').innerHTML = null
    maps.forEach((elem)=>{
        let pick = elem.pick
        let block = `<div class='map_block value='${elem.map}' onclick='map_choose(this)' ${elem.pick?'pick':elem.ban?'ban':null}'>`
        block+=`<img class='map_img' src='./maps/${elem.map}.map.jpg'/>`
        block+=`<span class='map_title'>${elem.map}</span></div>`;
        document.getElementById('maps_list').innerHTML += block;
    })
}

function map_choose(){
    document.getElementsByClassName('map_block').forEach((element)=>{
        element.onclick = (element)=>{
            let ind = maps.find((element, index, array)=>{
                return element.map == 'de_dust2'?index:null
            })
            let map = maps[ind]
            if(!map.pick && !map.ban){
                switch(game_type.toLowerCase()){
                    case 'bo1':
                        if((turn && team1 == team) || (!turn && team2 == team)){break;}
                        maps[ind]={
                            map: maps[ind].map,
                            pick: type?team:null,
                            ban: type?null:team,
                        }
                        break;
                    case 'bo2':
                        maps[ind]={
                            map: maps[ind].map,
                            pick: type?team:null,
                            ban: type?null:team,
                        }
                        break
                    case 'bo5':
                        maps[ind]={
                            map: maps[ind].map,
                            pick: type?team:null,
                            ban: type?null:team,
                        }
                        break
                    default:break
                }
            }
        }
    })
}

function message_read(event){
    let message = event.data
    let maps = message.maps;
    let game_type = message.game_type;
    let logs = message.logs
    let team;
    let team1 = message.team1
    let team2 = message.team2
    let turn = message.turn
    let type = message.type
    update()
}

function reconnect(){
    socket = new WebSocket(url);
    socket.onclose = function(){
        setTimeout(function(){reconnect(url)}, 1000);
    };
    socket.onerror  = ()=>{
        setTimeout(function(){reconnect(url)}, 1000);
    }
    socket.onopen = ()=>{
        socket.send("get_lobby_info");
    }
    socket.onmessage = (event)=>{
        message_read(event)
    }
}

reconnect()
</script>
</html>
